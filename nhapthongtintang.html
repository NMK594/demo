<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>T·∫∑ng v√© - Th√¥ng tin ng∆∞·ªùi nh·∫≠n</title>
    <link rel="stylesheet" href="styletang.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      /* Style cho form nh·∫≠p th√¥ng tin (ƒê√£ ƒëi·ªÅu ch·ªânh ƒë·ªÉ ph√π h·ª£p v·ªõi dark mode) */
      .gift-form-wrapper {
        padding: 18px;
        display: flex;
        justify-content: center;
        box-sizing: border-box;
      }
      .gift-form {
        width: 100%;
        max-width: 340px;
        background: #0f1720; /* N·ªÅn form t·ªëi ƒë·∫≠m */
        color: #fff;
        padding: 16px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(2, 6, 23, 0.6);
      }
      .gift-form h3 {
        margin: 0 0 12px;
        font-size: 16px;
        text-align: center;
      }
      .form-field {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-bottom: 12px;
      }
      .form-field label {
        font-size: 13px;
        color: #cbd5e1;
      }
      .form-field input[type="text"],
      .form-field input[type="email"] {
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.03);
        color: #fff;
        font-size: 14px;
      }
      .form-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 6px;
      }
      .btn-cancel {
        background: transparent;
        color: #9aa6bb;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-submit {
        background: #1866d6;
        color: #fff;
        border: none;
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.2s;
      }
      .btn-submit:hover {
        background: #0f58c7;
      }
      .hint {
        font-size: 12px;
        color: #94a3b8;
        text-align: center;
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <div class="phone-frame">
      <div class="status-bar">
        <span>10:08</span>
        <div>
          <i class="bi bi-wifi"></i>
          <span></span>
          <i class="bi bi-battery-half"></i>
        </div>
      </div>

      <div class="header-title">
        <a href="tangve.html" class="back-button">
          <i class="bi bi-arrow-left"></i>
        </a>
        <h2>T·∫∑ng v√©</h2>
      </div>

      <!-- L·ªöP PH·ª¶ X√ÅC TH·ª∞C PIN/OTP - M·∫∂C ƒê·ªäNH ·∫®N -->
      <div class="pin-overlay hidden">
        <!-- 1. H·ªòP NH·∫¨P PIN -->
        <div class="pin-box">
          <h3>Nh·∫≠p m√£ PIN x√°c th·ª±c</h3>
          <div class="pin-dots">
            <span></span><span></span><span></span> <span></span><span></span
            ><span></span>
          </div>
          <div class="pin-keypad">
            <button>1</button><button>2</button><button>3</button>
            <button>4</button><button>5</button><button>6</button>
            <button>7</button><button>8</button><button>9</button>
            <div></div>
            <button>0</button><button class="del">‚å´</button>
          </div>
        </div>

        <!-- 2. H·ªòP X√ÅC TH·ª∞C OTP (M·∫∂C ƒê·ªäNH ·∫®N) -->
        <div class="otp-box hidden">
          <h3 class="otp-title">X√°c th·ª±c Digital OTP</h3>
          <div class="otp-code-container">
            <div class="otp-code-display">
              <span></span><span></span><span></span><span></span> <span></span
              ><span></span><span></span><span></span>
            </div>
          </div>
          <p class="otp-timer-text">
            M√£ x√°c th·ª±c giao d·ªãch (OTP) c√≥ hi·ªáu l·ª±c trong v√≤ng
            <span id="otp-timer">45</span> gi√¢y
          </p>
          <button class="otp-verify-btn">X√°c th·ª±c</button>
        </div>
      </div>

      <!-- CUSTOM SUCCESS MODAL (THAY TH·∫æ ALERT) - M·∫∂C ƒê·ªäNH ·∫®N -->
      <div class="custom-modal-overlay hidden" id="successModal">
        <div class="custom-modal">
          <h4>Th√†nh c√¥ng!</h4>
          <p>
            Y√™u c·∫ßu t·∫∑ng v√© ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng cho ng∆∞·ªùi nh·∫≠n. B·∫°n s·∫Ω ƒë∆∞·ª£c
            chuy·ªÉn v·ªÅ trang V√© c·ªßa t√¥i.
          </p>
          <a
            href="chitietve2.html"
            class="modal-btn-ok link-as-button"
            id="btnOk"
            >Ho√†n t·∫•t</a
          >
        </div>
      </div>

      <div class="tabs-container">
        <button class="tab active">ƒêi·ªÅn th√¥ng tin</button>
      </div>

      <div class="content-wrapper">
        <!-- Form nh·∫≠p th√¥ng tin ng∆∞·ªùi nh·∫≠n -->
        <div class="gift-form-wrapper">
          <form id="giftForm" class="gift-form" novalidate>
            <h3>Nh·∫≠p th√¥ng tin ng∆∞·ªùi nh·∫≠n</h3>

            <div class="form-field">
              <label for="contact">Email ho·∫∑c SƒêT ƒë√£ ƒëƒÉng k√Ω</label>
              <input
                id="contact"
                name="contact"
                type="text"
                placeholder="email@example.com ho·∫∑c 0123456789"
                required
              />
            </div>

            <div class="form-field">
              <label for="fullname">H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n</label>
              <input
                id="fullname"
                name="fullname"
                type="text"
                placeholder="Nguy·ªÖn VƒÉn A"
                required
              />
            </div>

            <div class="form-field">
              <label for="message">L·ªùi nh·∫Øn (tu·ª≥ ch·ªçn)</label>
              <input
                id="message"
                name="message"
                type="text"
                placeholder="Ch√∫c b·∫°n xem vui v·∫ª!"
              />
            </div>

            <div class="form-actions">
              <button type="button" class="btn-cancel" id="btnCancel">
                Hu·ª∑
              </button>
              <button type="submit" class="btn-submit">G·ª≠i t·∫∑ng</button>
            </div>

            <p class="hint">
              S·ªë ƒëi·ªán tho·∫°i ho·∫∑c email ph·∫£i l√† th√¥ng tin ƒë√£ ƒëƒÉng k√Ω t√†i kho·∫£n.
            </p>
          </form>
        </div>

        <div style="height: 20px"></div>
      </div>

      <div class="footer-nav">
        <div class="nav-item">
          <span class="icon-text">t</span>
          <span class="label">Trang ch·ªß</span>
        </div>
        <div class="nav-item active">
          <span class="icon-active"></span>
          <span class="label">V√© c·ªßa t√¥i</span>
        </div>
        <div class="nav-item">
          <span class="icon-text">üë§</span>
          <span class="label">T√†i kho·∫£n</span>
        </div>
      </div>

      <div class="android-nav-bar">
        <span>&#9776;</span>
        <span>&#9675;</span>
        <span>&#9633;</span>
      </div>
    </div>

    <!-- C·∫ßn Crypto JS ƒë·ªÉ m√¥ ph·ªèng b·∫£o m·∫≠t OTP/Hasing, d√π QR code kh√¥ng c·∫ßn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script>
      // --- UTILITIES ---
      function isPhoneLike(str) {
        const digits = str.replace(/\D/g, "");
        return digits.length >= 9;
      }
      function isEmailLike(str) {
        return /\S+@\S+\.\S+/.test(str);
      }

      // --- PIN/OTP STATE AND ELEMENTS ---
      const pinOverlay = document.querySelector(".pin-overlay");
      const pinBox = pinOverlay.querySelector(".pin-box");
      const otpBox = pinOverlay.querySelector(".otp-box");
      const otpTimerDisplay = pinOverlay.querySelector("#otp-timer");
      const otpCodeSpans = pinOverlay.querySelectorAll(
        ".otp-code-display span"
      );
      const otpVerifyBtn = pinOverlay.querySelector(".otp-verify-btn");
      const dotsPin = pinOverlay.querySelectorAll(".pin-dots span");
      const keypad = pinOverlay.querySelectorAll(".pin-keypad button");
      const successModal = document.getElementById("successModal");
      const btnOk = document.getElementById("btnOk");

      let pin = "";
      const correctPIN = "050904"; // M√£ PIN m·∫´u
      let otpTimer;
      let currentOTP = "";
      let giftData = {}; // L∆∞u d·ªØ li·ªáu form t·∫°m th·ªùi

      // --- AUTHENTICATION LOGIC ---

      /**
       * B∆Ø·ªöC 3: B·∫Øt ƒë·∫ßu qu√° tr√¨nh x√°c th·ª±c b·∫±ng c√°ch hi·ªÉn th·ªã m√†n h√¨nh PIN.
       */
      function showPINOverlay(data) {
        giftData = data; // L∆∞u d·ªØ li·ªáu form

        // D·ª´ng v√† x√≥a b·ªô ƒë·∫øm c≈© n·∫øu c√≥ (an to√†n)
        if (otpTimer) clearInterval(otpTimer);

        // ƒê·∫£m b·∫£o ch·ªâ PIN box hi·ªÉn th·ªã
        otpBox.classList.add("hidden");
        pinBox.classList.remove("hidden");

        // HI·ªÇN TH·ªä L·ªöP PH·ª¶ CHUNG
        pinOverlay.classList.remove("hidden");

        // ƒê·∫∑t l·∫°i tr·∫°ng th√°i PIN
        pin = "";
        dotsPin.forEach((d) => d.classList.remove("filled"));
      }

      /**
       * B∆Ø·ªöC 4: X·ª≠ l√Ω ƒë·∫ßu v√†o t·ª´ b√†n ph√≠m s·ªë v√† chuy·ªÉn sang OTP n·∫øu PIN ƒë√∫ng
       */
      keypad.forEach((btn) => {
        btn.onclick = () => {
          // Ch·ªâ x·ª≠ l√Ω khi PIN BOX ƒëang hi·ªÉn th·ªã
          if (pinBox.classList.contains("hidden")) return;

          const val = btn.textContent;

          if (btn.classList.contains("del")) pin = pin.slice(0, -1);
          else if (pin.length < 6) pin += val;

          // C·∫≠p nh·∫≠t ch·∫•m PIN
          dotsPin.forEach((d, i) =>
            d.classList.toggle("filled", i < pin.length)
          );

          if (pin.length === 6) {
            if (pin === correctPIN) {
              // B∆Ø·ªöC 4a: PIN ƒë√∫ng -> CHUY·ªÇN T·ª™ PIN SANG OTP
              pinBox.classList.add("hidden");
              otpBox.classList.remove("hidden");
              startOTPCountdown();
            } else {
              // Hi·ªáu ·ª©ng l·ªói PIN sai
              pin = "";
              dotsPin.forEach((d) => d.classList.remove("filled"));
              pinBox.animate(
                [
                  { transform: "translateX(-8px)" },
                  { transform: "translateX(8px)" },
                  { transform: "translateX(-8px)" },
                  { transform: "translateX(0)" },
                ],
                { duration: 300 }
              );
            }
          }
        };
      });

      /**
       * Logic ƒê·∫øm ng∆∞·ª£c v√† T·∫°o m√£ OTP.
       */
      function startOTPCountdown() {
        let timeLeft = 45; // 45 gi√¢y ƒë·∫øm ng∆∞·ª£c

        function generateOTP() {
          // M√£ h√≥a d·ªØ li·ªáu (v√≠ d·ª•: m√£ PIN + th·ªùi gian) ƒë·ªÉ t·∫°o OTP duy nh·∫•t
          const base = correctPIN + Date.now().toString();
          let hash =
            typeof CryptoJS !== "undefined"
              ? CryptoJS.SHA256(base).toString().substring(0, 8) // L·∫•y 8 k√Ω t·ª± ƒë·∫ßu
              : "DEMO" + Math.floor(Math.random() * 9000 + 1000);

          // T·∫°o m√£ OTP 8 ch·ªØ s·ªë t·ª´ hash (ch·ªâ l·∫•y s·ªë)
          let otpCode = hash.replace(/\D/g, "").substring(0, 8);
          while (otpCode.length < 8) {
            otpCode += Math.floor(Math.random() * 10);
          }

          otpCodeSpans.forEach((span, index) => {
            span.textContent = otpCode[index];
          });
          currentOTP = otpCode; // L∆∞u OTP hi·ªán t·∫°i
          return otpCode;
        }

        function updateTimer() {
          otpTimerDisplay.textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(otpTimer);
            // T·∫°o OTP m·ªõi v√† b·∫Øt ƒë·∫ßu l·∫°i ƒë·∫øm ng∆∞·ª£c
            startOTPCountdown();
            return; // NgƒÉn ch·∫∑n timeLeft-- khi ƒë√£ h·∫øt gi·ªù
          }
          timeLeft--;
        }

        if (otpTimer) clearInterval(otpTimer);

        generateOTP();
        updateTimer();
        otpTimer = setInterval(updateTimer, 1000);
      }

      // --- FORM AND FINAL ACTION LOGIC ---

      document.getElementById("giftForm").addEventListener("submit", (e) => {
        // B∆Ø·ªöC 1: S·ª± ki·ªán x·∫£y ra khi nh·∫•n n√∫t "G·ª≠i t·∫∑ng"
        e.preventDefault();
        const contact = document.getElementById("contact").value.trim();
        const fullname = document.getElementById("fullname").value.trim();
        const message = document.getElementById("message").value;

        // B∆Ø·ªöC 2: Ki·ªÉm tra t√≠nh h·ª£p l·ªá c·ªßa Form (Validation)
        if (!fullname || fullname.length < 2) {
          console.error("Vui l√≤ng nh·∫≠p h·ªç v√† t√™n h·ª£p l·ªá.");
          return; // D·ª´ng l·∫°i n·∫øu form kh√¥ng h·ª£p l·ªá
        }
        if (!(isEmailLike(contact) || isPhoneLike(contact))) {
          console.error(
            "Vui l√≤ng nh·∫≠p Email h·ª£p l·ªá ho·∫∑c S·ªë ƒëi·ªán tho·∫°i (√≠t nh·∫•t 9 ch·ªØ s·ªë)."
          );
          return; // D·ª´ng l·∫°i n·∫øu form kh√¥ng h·ª£p l·ªá
        }

        // B∆Ø·ªöC 3: Form h·ª£p l·ªá -> B·∫Øt ƒë·∫ßu qu√° tr√¨nh x√°c th·ª±c PIN
        showPINOverlay({ contact, fullname, message });
      });

      /**
       * B∆Ø·ªöC 5: Logic khi nh·∫•n n√∫t "X√°c th·ª±c" tr√™n m√†n h√¨nh OTP (Gi·∫£ s·ª≠ OTP l√† ƒë√∫ng)
       */
      otpVerifyBtn.onclick = () => {
        // Ch·ªâ x·ª≠ l√Ω khi OTP BOX ƒëang hi·ªÉn th·ªã
        if (otpBox.classList.contains("hidden")) return;

        // D·ª´ng b·ªô ƒë·∫øm OTP
        clearInterval(otpTimer);

        // ·∫®n l·ªõp ph·ªß PIN/OTP
        pinBox.classList.add("hidden");
        otpBox.classList.add("hidden");
        pinOverlay.classList.add("hidden");

        // 5a. X·ª≠ l√Ω logic G·ª≠i t·∫∑ng (th√†nh c√¥ng)
        console.log("X√°c th·ª±c th√†nh c√¥ng. G·ª≠i t·∫∑ng v√©...");

        // B∆Ø·ªöC 6: Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng (Custom Modal)
        successModal.classList.remove("hidden");
      };

      // S·ª± ki·ªán cho n√∫t "Ho√†n t·∫•t" trong Custom Modal
      btnOk.addEventListener("click", () => {
        // ·∫®n modal
        successModal.classList.add("hidden");
        // Quay l·∫°i trang v√© (gi·∫£ l·∫≠p chuy·ªÉn trang)
        // location.href = 'tru1ve.html';
        console.log("Chuy·ªÉn h∆∞·ªõng v·ªÅ trang v√© c·ªßa t√¥i...");
      });

      document.getElementById("btnCancel").addEventListener("click", () => {
        // Quay l·∫°i trang tr∆∞·ªõc (gi·∫£ l·∫≠p)
        // location.href = 'tangve.html';
        console.log("H·ªßy v√† quay l·∫°i trang tr∆∞·ªõc.");
      });
    </script>
  </body>
</html>
